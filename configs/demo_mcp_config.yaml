# Azure Container App Configuration
# Exposes both UI and MCP on port 8080
binds:
- port: 8080
  listeners:
  - routes:
    # Admin UI route (must come before MCP routes)
    - name: ui-route
      matches:
      - path:
          pathPrefix: /ui
      backends:
      - host: 127.0.0.1:15000

    # Admin API route (for config management)
    - name: admin-api-route
      matches:
      - path:
          pathPrefix: /config
      backends:
      - host: 127.0.0.1:15000

    - hostnames: []
      matches:
      - path:
          pathPrefix: /pii-test
      backends:
      - mcp:
          securityGuards:
          - id: tool-poisoning
            type: tool_poisoning
            runs_on:
            - request
            - response
          - id: pii-guard
            type: pii
            runs_on:
            - request
            - response
            - tool_invoke
            detect:
            - email
            - credit_card
            action: mask
          targets:
          - name: pii-mcp
            mcp:
              host: http://127.0.0.1:8000/mcp
          statefulMode: stateful
      name: pii-guard
      policies:
        cors:
          allowCredentials: false
          allowHeaders:
          - '*'
          allowMethods:
          - '*'
          allowOrigins:
          - '*'
          exposeHeaders:
          - mcp-session-id
          maxAge: null
    - hostnames: []
      matches:
      - path:
          pathPrefix: /poison
      backends:
      - mcp:
          securityGuards:
          - id: tool-poisoning
            type: tool_poisoning
            runs_on:
            - request
            - response
          targets:
          - name: poison
            mcp:
              host: http://127.0.0.1:8010/mcp
          statefulMode: stateful
      name: tool-poisoning
      policies:
        cors:
          allowCredentials: false
          allowHeaders:
          - '*'
          allowMethods: []
          allowOrigins:
          - '*'
          exposeHeaders:
          - mcp-session-id
          maxAge: null
